<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Cardiac Pharmacy Tickets (Demo)</title>
<style>

  :root{ --bg:#ffffff; --ink:#111; --on:#000; --noshow:#9ca3af; --printed:#16a34a; }
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--ink);background:var(--bg)}
  header{padding:18px 14px 6px;text-align:center}
  h1{margin:0;font-size: clamp(22px, 4.8vw, 40px); font-weight:800}
  .ranges{display:grid;grid-template-columns: repeat(5, minmax(100px,1fr));gap:12px;max-width:980px;margin:14px auto;padding:0 14px}
  .ranges button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;background:#eef2f7;color:#1870d6;cursor:pointer}
  .ranges button.active{background:#111;color:#fff}
  .nowBar{max-width:980px;margin:10px auto 16px;padding:18px 14px;background:#000;color:#fff;border-radius:12px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .nowText{font-size: clamp(18px, 4.5vw, 42px); font-weight:800; line-height:1.1}
  .nowNum{font-size: clamp(32px, 8vw, 84px); font-weight:800}
  .nowMrn{font-size: clamp(12px, 2.6vw, 16px); opacity:.9; user-select:text; -webkit-user-select:text; margin-top:6px}
  .nowRight{display:flex; flex-direction:column; align-items:flex-end; gap:4px}
  .actions{display:flex; gap:10px}
  .btn{border:0; border-radius:10px; padding:12px 16px; font-weight:700; cursor:pointer;}
  .btn.next{background:#22c55e;color:#fff}
  .btn.noshow{background:#eab308;color:#111}
  .btn.restart{background:#ef4444;color:#fff}
  .gridWrap{max-width:1040px;margin:0 auto 28px;padding:0 14px}
  .grid{display:grid;grid-template-columns: repeat(10, 1fr);gap:10px;}
  .cell{user-select:none;border:2px solid #111;border-radius:10px;padding:10px 0;font-weight:700;text-align:center;cursor:pointer;transition:transform .06s ease;background:#fff;color:#111}
  .cell:active{transform:scale(.97)}
  .cell.on{background:var(--on);color:#fff;border-color:#000}
  .cell.noshow{background:var(--noshow);color:#fff;border-color:#6b7280}
  .cell.printed{background:var(--printed);color:#fff;border-color:#15803d}
  @media (max-width:720px){ .grid{grid-template-columns: repeat(6, 1fr);} }
  @media (max-width:450px){ .grid{grid-template-columns: repeat(5, 1fr);} }

</style>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <header><h1>Cardiac Pharmacy Tickets (Demo)</h1></header>
  <div class="ranges" id="ranges"></div>

  <div class="nowBar">
    <div class="nowText">Now<br>Serving:</div>
    <div class="nowRight">
      <div class="nowNum" id="nowServing">-</div>
      <div class="nowMrn" id="nowMrn">MRN: —</div>
    </div>
    <div class="actions">
      <button class="btn noshow" id="btnNoShow">No&nbsp;Show</button>
      <button class="btn next" id="btnNext">Next</button>
      <button class="btn restart" id="btnRestart">Restart</button>
    </div>
  </div>

  <div class="gridWrap"><div id="grid" class="grid"></div></div>

<script>
(function(){
  const firebaseConfig = { apiKey:"AIzaSyCWWnMsge75Q3_MDF9Aj9wo4C5KD6RVGfw", authDomain:"q-matic-b7d77.firebaseapp.com", databaseURL:"https://q-matic-b7d77-default-rtdb.firebaseio.com", projectId:"q-matic-b7d77", storageBucket:"q-matic-b7d77.appspot.com", messagingSenderId:"908187704899", appId:"1:908187704899:web:b8bcf33cda90bafe81bef6" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const ROOT='cardiac_demo';
  const NUMBERS = ROOT + '/numbers';
  const LATEST  = ROOT + '/latest';
  const TICKETS = ROOT + '/tickets';

  const rangesEl = document.getElementById('ranges');
  const gridEl   = document.getElementById('grid');
  const nowEl    = document.getElementById('nowServing');
  const mrnEl    = document.getElementById('nowMrn');
  const btnNext  = document.getElementById('btnNext');
  const btnNoShow= document.getElementById('btnNoShow');
  const btnRestart=document.getElementById('btnRestart');

  let currentRangeStart = 1;
  let currentNumber = null;

  for(let s=1;s<=1000;s+=100){
    const e=s+99; const b=document.createElement('button');
    b.textContent = s + '–' + e; b.onclick=()=>showRange(s,e,b);
    if(s===1) b.classList.add('active'); rangesEl.appendChild(b);
  }

  function showRange(start,end,btn){
    currentRangeStart=start;
    document.querySelectorAll('.ranges button').forEach(x=>x.classList.remove('active'));
    if(btn) btn.classList.add('active');
    gridEl.innerHTML='';
    for(let n=start;n<=end;n++){
      const d=document.createElement('div');
      d.className='cell'; d.textContent=n; d.dataset.n=n;
      let clickTimer=null;
      d.addEventListener('click', ()=>{
        const n=Number(d.dataset.n);
        if(clickTimer){ clearTimeout(clickTimer); clickTimer=null; clearState(n); return; }
        clickTimer=setTimeout(()=>{ clickTimer=null; setOn(n); updateLatest(n); autoSwitch(n); }, 300);
      });
      gridEl.appendChild(d);
      db.ref(NUMBERS+'/'+n).on('value', snap=>{ 
        const v=snap.val(); d.classList.remove('on','noshow','printed');
        if(v==='on') d.classList.add('on');
        else if(v==='noshow') d.classList.add('noshow');
        else if(v==='printed') d.classList.add('printed');
      });
    }
  }

  function setOn(n){ db.ref(NUMBERS+'/'+n).set('on'); }
  function clearState(n){ db.ref(NUMBERS+'/'+n).remove(); }
  function updateLatest(n){
    currentNumber = n; nowEl.textContent=n;
    db.ref(LATEST).set({ number:n, ts: Date.now() });
    db.ref(TICKETS+'/'+n).once('value').then(s=>{ 
      const t=s.val();
      mrnEl.textContent = 'MRN: ' + (t && t.mrn ? t.mrn : '—');
    });
  }
  function loadMrnFor(n){
    db.ref(TICKETS+'/'+n).once('value').then(s=>{ 
      const t=s.val();
      mrnEl.textContent = 'MRN: ' + (t && t.mrn ? t.mrn : '—');
    });
  }

  function autoSwitch(n){
    const s = Math.floor((n-1)/100)*100 + 1;
    if(s!==currentRangeStart){
      const idx=(s-1)/100;
      const btn = rangesEl.children[idx];
      showRange(s, s+99, btn);
    }
  }

  db.ref(LATEST).on('value', snap=>{ 
    const data=snap.val();
    if(!data||!data.number){ nowEl.textContent='-'; mrnEl.textContent='MRN: —'; currentNumber=null; return; }
    nowEl.textContent=data.number; currentNumber=data.number; autoSwitch(currentNumber);
    loadMrnFor(currentNumber);
  });

  btnNoShow.onclick=()=>{ if(!currentNumber) return; db.ref(NUMBERS+'/'+currentNumber).set('noshow'); };
  btnNext.onclick=()=>{ const n = currentNumber ? (currentNumber % 1000) + 1 : 1; setOn(n); updateLatest(n); autoSwitch(n); };
  btnRestart.onclick=()=>{ 
    if(!confirm('Are you sure you want to clear all and restart?')) return;
    db.ref(ROOT).remove();
    nowEl.textContent='-'; mrnEl.textContent='MRN: —';
    showRange(currentRangeStart, currentRangeStart+99, document.querySelector('.ranges button.active') || rangesEl.firstElementChild);
  };

  showRange(1,100, rangesEl.firstElementChild);
})();
</script>
</body>
</html>